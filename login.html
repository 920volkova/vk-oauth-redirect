<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>VK ID Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <h2>Войти через VK ID</h2>
  <div id="vkid-container"></div>
  <p id="status"></p>

  <!-- 1) ПІДКЛЮЧАЄМО SDK (точна версія та коректний шлях) -->
  <!-- Варіант 1 (unpkg): -->
  <script src="https://unpkg.com/@vkid/sdk@3.0.0/dist/umd/index.js"></script>
  <!-- Резерв (jsDelivr), якщо unpkg блокується розширеннями: -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/@vkid/sdk@3.0.0/dist/umd/index.js"></script> -->

  <script>
    // Чекаємо, поки SDK з’явиться в window
    function whenReady(cb, tries = 40) {
      if (window.VKIDSDK && window.VKIDSDK.VKID) return cb();
      if (tries <= 0) {
        alert('VKID SDK не загрузился');
        document.getElementById('status').textContent = 'Не удалось загрузить VKID SDK.';
        return;
      }
      setTimeout(() => whenReady(cb, tries - 1), 150);
    }

    whenReady(() => {
      const VKID = window.VKIDSDK.VKID;

      VKID.Config.init({
        app: 54164270,  // <-- якщо App ID інший — заміни тут
        redirectUrl: 'https://920volkova.github.io/vk-oauth-redirect/',
        responseMode: VKID.ConfigResponseMode.Callback,
        source: VKID.ConfigSource.LOWCODE
      });

      const oneTap = new VKID.OneTap();
      oneTap.render({
        container: document.getElementById('vkid-container'),
        showAlternativeLogin: true
      }).on(VKID.WidgetEvents.ERROR, (err) => {
        document.getElementById('status').textContent = 'Ошибка виджета: ' + (err && err.message ? err.message : err);
        console.error(err);
      }).on(VKID.OneTapInternalEvents.LOGIN_SUCCESS, (payload) => {
        document.getElementById('status').textContent = 'Логин успешен, перенаправление...';
        // Далі VK сам перекине на redirectUrl із токеном у фрагменті
      });
    });
  </script>
</body>
</html>
