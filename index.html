<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>VK OAuth Redirect</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 24px; color: #111; }
    .card { max-width: 760px; border: 1px solid #e5e7eb; border-radius: 12px; padding: 20px; box-shadow: 0 1px 10px rgba(0,0,0,.04);}
    h1 { margin: 0 0 10px; font-size: 22px; }
    code, .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    .row { display: grid; grid-template-columns: 180px 1fr auto; gap: 10px; align-items: center; padding: 8px 0; border-top: 1px dashed #eee; }
    .row:first-of-type { border-top: none; }
    .label { color: #6b7280; }
    .value { word-break: break-all; }
    button { padding: 6px 10px; border: 1px solid #cbd5e1; border-radius: 8px; cursor: pointer; background: #fff; }
    .ok { color: #047857; }
    .err { color: #b91c1c; }
    .muted { color: #6b7280; }
  </style>
</head>
<body>
  <div class="card">
    <h1>VK OAuth Redirect</h1>
    <p class="muted">Ця сторінка зчитує параметри з <span class="mono">location.hash</span> після повернення з OAuth.</p>

    <div id="rows"></div>

    <div id="hint" class="muted" style="margin-top:14px;"></div>
  </div>

  <script>
    // Зчитуємо параметри з #hash (access_token повертається саме у hash при implicit flow)
    const hash = window.location.hash.startsWith('#') ? window.location.hash.slice(1) : window.location.hash;
    const params = new URLSearchParams(hash);

    const data = {
      access_token: params.get("access_token"),
      expires_in: params.get("expires_in"),
      user_id: params.get("user_id"),
      state: params.get("state"),
      error: params.get("error"),
      error_description: params.get("error_description")
    };

    const rows = document.getElementById('rows');

    function addRow(label, value, copyId) {
      const row = document.createElement('div');
      row.className = 'row';
      row.innerHTML = `
        <div class="label">${label}</div>
        <div class="value"><span id="${copyId || ''}" class="mono">${value ?? '—'}</span></div>
        ${copyId ? `<div><button data-copy="${copyId}">Copy</button></div>` : `<div></div>`}
      `;
      rows.appendChild(row);
    }

    // Малюємо
    if (data.access_token) {
      addRow('Статус', '<span class="ok">Токен отримано</span>');
      addRow('access_token', data.access_token, 'tok');
      addRow('expires_in', data.expires_in);
      addRow('user_id', data.user_id);
      addRow('state', data.state);
      document.getElementById('hint').textContent =
        'Збережіть токен у безпечному місці. Натисніть Copy, щоб скопіювати.';
    } else if (data.error) {
      addRow('Статус', `<span class="err">Помилка OAuth</span>`);
      addRow('error', data.error);
      addRow('error_description', data.error_description);
      document.getElementById('hint').textContent =
        'Перевірте налаштування застосунку (redirect URL, доступи, тип авторизації).';
    } else {
      addRow('Статус', 'Токен не знайдено');
      document.getElementById('hint').textContent =
        'Схоже, сторінка відкрита напряму. Перейдіть на сторінку логіну та авторизуйтесь заново.';
    }

    // Копіювання в буфер
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('button[data-copy]');
      if (!btn) return;
      const id = btn.getAttribute('data-copy');
      const el = document.getElementById(id);
      if (!el) return;
      navigator.clipboard.writeText(el.textContent.trim()).then(() => {
        btn.textContent = 'Copied!';
        setTimeout(() => (btn.textContent = 'Copy'), 1200);
      }).catch(() => alert('Не вдалося скопіювати'));
    });
  </script>
</body>
</html>
